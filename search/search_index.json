{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Welcome to the SUPAROO25 documentation","text":"<p>You can access the course overview following this link</p> <p>Access each of the Lecture's tutorials here:</p> <ul> <li>Lecture 1</li> <li>Lecture 2</li> <li>Lecture 3</li> </ul>"},{"location":"lecture1/","title":"Lecture 1","text":""},{"location":"lecture1/#reading-and-writing-root-files","title":"Reading and Writing ROOT files","text":"<p>In this first lecture we will learn how to setup ROOT in your machine and the basics of reading and writing ROOT files. </p>"},{"location":"lecture1/#setting-up-root","title":"Setting up ROOT","text":"<p>If you want to install ROOT in your machine, you can follow the instructions in the ROOT website. In my experience one does not simply install ROOT in their first try, so good luck!</p> <p>With access to cvmfs on one of the Lab Room machines, you can simply run the following command to setup ROOT:</p> <pre><code>setup root\n</code></pre>"},{"location":"lecture1/#downloading-the-data","title":"Downloading the data","text":"<p>We will use some pregenerated Monte Carlo events coming from ATLAS for the purpose of this tutorial. You can download this data from here. Or you can type the following command in your terminal:</p> <pre><code>wget https://www.example.com/data.root\n</code></pre> <p>This file contains some processed Monte Carlo events for top anti-top pair production for the latest Run3 centre of mass energy of 13.6 TeV at the LHC. </p>"},{"location":"lecture1/#viewing-the-contents-of-the-file","title":"Viewing the contents of the file","text":"<p>We can view the contents of this file by running the following command <code>root [options] [file]</code>. For example:</p> <pre><code>root -l mc23_13p6TeV.ttbar_PP8.root\n</code></pre> <p>Available options are:</p> Option Description -l Start ROOT in interactive mode (no startup screen) -b Start ROOT in batch mode (no graphics) -q Quit ROOT after processing the file -x Exit ROOT after processing the file <p>I would recommend always using the <code>-l</code> option to make it load up faster. In the latest versions of ROOT, specially if you install it on your own machine, there is an annoying new feature were it will always try to open a browser window whenever you draw stuff. You can disable this by opening root like <code>root -l --web=off [more options] [file]</code>.</p> <p>To list the contents of a file you can use the following command:</p> <pre><code>root[1] _file0-&gt;ls()\n</code></pre> <p>By default, if you open the root file as before it will rename it to <code>_file0</code>. Alternatively you can do <code>root[1] .ls</code>, which is faster. You will see a big list of objects in the file, which are the histograms and trees that were saved in the file. Trees are saved as TTree objects and histograms are saved as TH1F, TH1D, TH2F, TH2D, etc. For the latter, the number at the end indicates the number of dimensions of the histogram, and the letter indicates the type of the bin content (F for float, D for double).</p> <p>We are interested in exploring the contents of the TTree called <code>reco</code>, so we can do the following:</p> <pre><code>root[1] reco-&gt;Show(0)\n</code></pre> <p>Note</p> <p>From now on I will omit the <code>root[1]</code> header from the commands. But remember that these commands will only run in the ROOT interpreter.</p> <p>You will again see a big list of TBranches stored in the TTree. With the command <code>reco-&gt;Show(0)</code> we are asking ROOT to show the contents of the first event in the TTree. If you want to see the contents of the 10th event you can do <code>reco-&gt;Show(9)</code>.</p> <p>Other visualisation options</p> <p>There are other ways to explore the contents of the TTree, like <code>reco-&gt;Print()</code> or <code>reco-&gt;Scan()</code>. With the latter you can select which branches you want to see, for example: <pre><code>reco-&gt;Scan(\"jet_pt_NOSYS:jet_eta:jet_phi\")\n</code></pre> With <code>Scan</code> you may also fo simple arithmetic operations like <pre><code>reco-&gt;Scan(\"jet_pt_NOSYS/1000:nElectrons+nMuons\")\n</code></pre></p> <p>You may notice that some branches have a single value associated to them while others, like <code>jet_pt_NOSYS</code>, are labelled as a <code>vector&lt;float&gt;</code>. This is because the TTree is storing a collection of values for that branch. For example, the branch <code>jet_pt_NOSYS</code> is storing the transverse momentum of all jets in each of the events. </p>"},{"location":"lecture1/#tbrowser","title":"TBrowser","text":"<p>Another tool for easy visualisation is the TBrowser. You can open it by running the following command:</p> <pre><code>new TBrowser()\n</code></pre> <p>You will get prompted with an old-school looking window with a list of all the objects in the file. You can click on the objects to see their contents as histograms on the right panel.</p> TBrowser example <p></p> <p>Feel free to explore the contents of the file using the TBrowser. </p> <ul> <li>Can you find the histograms of the variables we were scanning before? </li> <li>Notice how <code>vector&lt;float&gt;</code> branches also show up as normal looking histograms. Can you spot the difference between them and the single value branches?</li> </ul> <p>While this is a nice tool for quick visualisation, it is not very useful for more complex operations. For that we will need to write some code.</p>"},{"location":"lecture1/#writing-some-code-in-the-terminal","title":"Writing some code in the terminal","text":"<p>We can ask root in the command line to draw the same histograms we were seeing in the TBrowser. This will create a new window (or TCanvas as ROOT calls it) with the histogram. The syntax is <code>tree_name-&gt;Draw(\"branch_name\", \"weights*selections\", \"options)</code>. Available options for drwaing can be found in the THistPainter ROOT Class. Typicalle, using \"HIST E\" will draw a standard histogram with error bars and the data points (it does not care about upper/lower case).</p> <p>For example:</p> <pre><code>reco-&gt;Draw(\"jet_pt_NOSYS/1000\", \"weight_mc_NOSYS\", \"hist\"); // This will draw the jet_pt_NOSYS in GeV and with the Monte Carlo event weight applied\n\nreco-&gt;Draw(\"jet_pt_NOSYS/1000[0]\", \"weight_mc_NOSYS\", \"hist e\"); // This will draw the first jet in the event\n\nreco-&gt;Draw(\"jet_pt_NOSYS/1000\", \"weight_mc_NOSYS*nJets&gt;4\", \"hist e\"); // This will draw the jet_pt_NOSYS histogram only for events with more than 4 jets\n</code></pre> <p>Note</p> <p>The <code>weight_mc_NOSYS</code> branch is a Monte Carlo generator specific weight that is applied to each event to quantify the probability of that event happening for a given process. This is always applied to ensure that the simulation will reproduce the data as closely as possible.  </p> <p>This visualisation method is very powerful for quick checks of your root files as you can reproduce any histogram with any selection you want at the expense of working with the terminal. However, for bigger analysis you will want to write a macro.</p>"},{"location":"lecture1/#advanced-used-of-terminal-commands","title":"Advanced used of terminal commands","text":"<p>As you have seen, the <code>Draw()</code> function outputs a decent-looking histogram, but it is not very flexible. For that you will need to use the TH1 class directly: <code>TH1F(\"hist_name\", \"Title\", Nbins, xmin, xmax)</code> and the <code>Project()</code> function. We can replicate the above diagrams using the following: </p> <pre><code>TH1F *h_jet_pt = new TH1F(\"h_jet_pt\", \"Jet p_{T}\", 25, 0, 400); // I can now control the number and ranges of the bins in the x-axis, as well as giving my plot a title\nreco-&gt;Project(\"h_jet_pt\", \"jet_pt_NOSYS/1000\", \"weight_mc_NOSYS\"); // This is the equivalent of the Draw() function\nh_jet_pt-&gt;Draw(\"hist\"); // This will draw the histogram in a new canvas\n</code></pre> <p>At this stage one can also make the plot more fancy by adding a legend, axis labels, changing the line color and style, aspect ratio, etc. But we will dive into all of these options in the next lecture.</p>"},{"location":"lecture1/#looping-over-the-root-file","title":"Looping over the ROOT file","text":"<p>For more complex calculations, for instance if you want to calculate the invariant mass of a pair of jets, or boost to a certain frame, you will need to write a macro. You may use either Pyhton or C++ for this, whatever you feel more comfortable with. You can run the Python code in the terminal using <code>python3 [programName.py]</code> and the C++ code using <code>root -l [programName.C]</code>.</p> <p>Below are two example codes that do the exact same thing, but one is in Python and the other in C++. Both loop over all of the events and declare two histograms, one for the leading jet transverse momentum and another for the number of jets in the event. However, both have the same bug that will throw an error. Can you spot it, and fix it?</p> <p>Note that none of them will produce any output since they are just internally declaring the histograms, however if you run the C++ version you will have access to the newly created histograms in the ROOT interpreter. This means you can plot them using e.g. <code>h_lead_jet_pt-&gt;Draw()</code>.</p> <pre><code>#include &lt;TFile.h&gt;\n#include &lt;TTree.h&gt;\n\nvoid programName() {\n\n    // Declare a new file with the option \"READ\"\n    TFile *f = new TFile(\"mc23_13p6TeV.ttbar_PP8.root\", \"READ\");\n    // Fetch the TTree called \"reco\" from the file\n    TTree *reco = (TTree*)f-&gt;Get(\"reco\");\n\n    // Declare the variables that will be stored in the branches\n    Int_t nJets;\n    std::vector&lt;float&gt; *jet_pt = nullptr;\n\n    // Link the branches to the variables\n    reco-&gt;SetBranchAddress(\"jet_pt_NOSYS\", &amp;jet_pt);\n    reco-&gt;SetBranchAddress(\"nJets\", &amp;nJets);\n\n    // Declare the histograms\n    TH1F *h_lead_jet_pt = new TH1F(\"h_lead_jet_pt\", \"Leading jet p_{T}\", 25, 0, 400);\n    TH1F *h_nJets = new TH1F(\"h_nJets\", \"Number of jets\", 10, 0, 10);\n\n    // Loop over all the events in the TTree and fill the histograms\n    for (Int_t i = 0; i &lt; reco-&gt;GetEntries(); i++) {\n        reco-&gt;GetEntry(i);\n        h_lead_jet_pt-&gt;Fill(jet_pt-&gt;at(0)/1000);\n        h_nJets-&gt;Fill(nJets);\n    }\n}\n</code></pre> <p>Python version of the code</p> <pre><code>import ROOT\n\n# Declare a new file with the option \"READ\"\nf = ROOT.TFile(\"mc23_13p6TeV.ttbar_PP8.root\")\n# Fetch the TTree called \"reco\" from the file\nreco = f.Get(\"reco\")\n\n# Declare the histograms\nh_lead_jet_pt = ROOT.TH1F(\"h_lead_jet_pt\", \"Leading jet p_{T}\", 25, 0, 400)\nh_nJets = ROOT.TH1F(\"h_nJets\", \"Number of jets\", 10, 0, 10)\n\n# Loop over all the events in the TTree and fill the histograms\nfor i in range(reco.GetEntries()):\n    reco.GetEntry(i)\n    h_lead_jet_pt.Fill(reco.jet_pt_NOSYS[0]/1000)\n    h_nJets.Fill(reco.nJets)\n</code></pre>"},{"location":"lecture1/#rdataframe","title":"RDataFrame","text":"<p>The RDataFrame class is a new feature in ROOT that allows you to do complex operations on the TTree in a more Pythonic way. The full documentation along with more examples can be found in the RDataFrame Class. For example, the following code will do the same as the previous examples, but in a more compact way:</p> <pre><code>void programName() {\n    // We select the TTree and the file at the same time\n    ROOT::RDataFrame d(\"reco\", \"mc23_13p6TeV.ttbar_PP8.root\"); \n\n    // Automatic booking of the histogram, TBranch and variable type\n    auto h_nJets = d.Histo1D&lt;int&gt;(\"nJets\");\n\n    // This runs the event loop, it's equivalent to the for loop we implemented above\n    h_nJets-&gt;DrawClone();\n}\n</code></pre> Possible crashes with ROOT <p>You may notice that when you run the code for the first time it runs smoothly, but upon running it again inside the ROOT interpreter, with <code>.x programName.C</code> you will get a crash. While I don't know the exact reason why this happens, I suspect it is because ROOT is trying to create the histograms again, but they already exist within the running session. You can fix this by existing ROOT and running the <code>root programName.C</code> again. </p> <p>Python version of the code</p> <pre><code>import ROOT\n\n# We select the TTree and the file at the same time\nd = ROOT.RDataFrame(\"reco\", \"mc23_13p6TeV.ttbar_PP8.root\")\n\n# Automatic booking of the histogram and TBranch and variable type\nh_nJets = d.Histo1D(\"nJets\")\n\n# This runs the event loop, it's equivalent to the for loop we implemented above\nh_nJets.DrawClone()\n</code></pre>"},{"location":"lecture1/#writing-to-a-root-file","title":"Writing to a ROOT file","text":"<p>Now that we have explored the contents of the file, we can write some new histograms, trees and branches to a new root file. This is very useful if you want to save the results of your analysis for later use. We will make use of the <code>TObject::Write</code> method and <code>TFile(\"[filename]\", \"[option]\")</code> class with the following options:</p> Option Description READ Open the file for reading RECREATE Create a new file, if it already exists it will be overwritten UPDATE Open the file for reading and writing CREATE Create a new file, if it already exists it will throw an error <pre><code>#include &lt;TFile.h&gt;\n#include &lt;TTree.h&gt;\n\nvoid programName() {\n\n    // Declare a new file with the option \"RECREATE\"\n    TFile *f = new TFile(\"out.root\", \"RECREATE\");\n    // Declare a new tree with the name \"tree\" and the title \"Example Tree\"\n    TTree *tree = new TTree(\"tree\", \"Example Tree\");\n\n    // Declare a float variable \"poisson\"\n    float poisson;\n    // Declare a histogram with the name \"h\", the title \"Poisson\", 10 bins from 0 to 10\n    TH1F *h = new TH1F(\"h\", \"Poisson\", 10, 0, 10);\n\n    // Book the branch \"branch_poisson\" to the tree and link it to the variable \"poisson\", you can also specify the variable type\n    tree-&gt;Branch(\"branch_poisson\", &amp;poisson, \"poisson/F\");\n\n    for (Int_t i = 0; i &lt; 1000; i++) {\n        // For each 'event', fill the variable 'poisson' with a Poisson distribution with mean 5\n        poisson = gRandom-&gt;Poisson(5);\n        // Fill the histogram with the value of 'poisson'\n        h-&gt;Fill(poisson);\n        // Fill al the branches of the tree\n        tree-&gt;Fill();\n    }\n\n    // Write the histogram and the tree to the file\n    h-&gt;Write();\n    tree-&gt;Write();\n\n    // Close the file\n    f-&gt;Close();\n\n}\n</code></pre> <p>Python version of the code</p> <pre><code>import ROOT\nfrom array import array\n\n# Declare a new file with the option \"RECREATE\"\nf = ROOT.TFile(\"out.root\", \"RECREATE\")\n# Declare a new tree with the name \"tree\" and the title \"Example Tree\"\ntree = ROOT.TTree(\"tree\", \"Example Tree\")\n\n# Declare a 1D float array to store the variable \"poisson\"\npoisson = array('f', [0])\n# Declare a histogram with the name \"h\", the title \"Poisson\", 10 bins from 0 to 10\nh = ROOT.TH1F(\"h\", \"Poisson\", 10, 0, 10)\n\n# Book the branch \"branch_poisson\" to the tree and link it to the variable \"poisson\", you can also specify the variable type\ntree.Branch(\"branch_poisson\", poisson, \"poisson/F\")\n\nfor i in range(1000):\n    # For each 'event', fill the variable 'poisson' with a Poisson distribution with mean 5\n    poisson[0] = ROOT.gRandom.Poisson(5)\n    # Fill the histogram with the value of 'poisson'\n    h.Fill(poisson[0])\n    # Fill all the branches of the tree\n    tree.Fill()\n\n# Write the histogram and the tree to the file\nh.Write()\ntree.Write()\n\n# Close the file\nf.Close()\n</code></pre> Overwriting TObjects <p>Sometimes ROOT does not want to cooperate when rewriting existing trees or histagrams, you can force this to happen by calling the <code>TObject::Write</code> method with the option <code>kOverwrite</code>. For example: <pre><code>tree-&gt;Write(\"\", TObject::kOverwrite);\n</code></pre></p> <p>You can now inspect the new root file with the methods we have learned before. </p> <ul> <li>Notice how branches will always be saved inside the TTree, while the histogram is stored as a separate object in the file. </li> <li>Check out how the same data is represented in the TH1F histogram and the TBranch. Which method do you prefer? Which one is more flexible?</li> <li>We have seen how vectors are very commonly used as well. Can you modify the code to save a <code>vector&lt;float&gt;</code> branch that contains a Poisson distribution with mean=1 in the first element, mean=2 in the second, and so on?</li> </ul> Vector Solution SPOILER! <pre><code>std::vector&lt;float&gt; poisson_vector;\ntree-&gt;Branch(\"branch_poisson_vector\", &amp;poisson_vector);\nfor (Int_t i = 0; i &lt; 1000; i++) {\n    // For each 'event', we first clear the vector\n    poisson_vector.clear();\n    for (Int_t j = 0; j &lt; 10; j++) {\n        // We use the push_back method to each of the elements to the vector\n        poisson_vector.push_back(gRandom-&gt;Poisson(j+1));\n    }\n    tree-&gt;Fill();\n}\n</code></pre> <p>This concludes the first lecture. In the next one we will learn how to make more complex plots, how to fit functions to histograms, and how to make your plots look more professional. Below is an exercise that will put to test all the knowledge you have acquired in this lecture.</p>"},{"location":"lecture1/#exercise-1","title":"Exercise 1","text":"<ol> <li>Write a macro that reads the file <code>mc23_13p6TeV.ttbar_PP8.root</code> and saves at least the following branches to a new root file called <code>ttbar_PP8_analysis.root</code>:<ul> <li>The jet transverse momentum (<code>vector&lt;float&gt; jet_pt_NOSYS</code>)</li> <li>The lepton transverse momentum (<code>vector&lt;float&gt; lepton_pt_NOSYS</code>)</li> <li>The lepton pseudorapidity (<code>vector&lt;float&gt; lepton_eta</code>)</li> <li>The lepton azimuthal angle (<code>vector&lt;float&gt; lepton_phi</code>)</li> <li>The lepton energy (<code>vector&lt;float&gt; lepton_e_NOSYS</code>)    </li> <li>The number of jets in the event (<code>int nJets</code>)</li> <li>The number of leptons in the event (<code>int nLeptons</code>)</li> <li>The number of b-jets in the event (<code>int nBjets_GN2v01_77WP</code>)</li> <li>The event Monte Carlo weight (<code>float weight_mc_NOSYS</code>)</li> </ul> Advanced Hint <p>Look up the <code>TTree::CloneTree()</code> and <code>TTree::SetBranchStatus()</code> methods in the ROOT documentation to make your code smarter and faster.</p> </li> <li>From the new root file: <ul> <li>What are the average values for the number of jets, b-jets and leptons in the sample? This is a ttbar NLO sample, where both tops decay leptonically (e.g. t-&gt;Wb-&gt;l\u03bdb), do the values you see make sense?</li> <li>Make a histogram of the leading and sub-leading jet transverse momentum for events with at least 3 jets and at least 1 b-jet. Remember that events in a histogram should be weighted using the Monte Carlo weight. Save it to the same root file.</li> <li>Make another histogram of the leading lepton transverse momentum for events with at least 2 leptons, at least 1 b-jet and save it.</li> </ul> </li> <li>Construct the lepton's four-momentum vectors and calculate the invariant mass of the lepton pair. Make a histogram of the invariant mass for events with exactly 2 leptons and at least 1 b-jet. Save it to the same root file.</li> </ol> Hint <p>Look up the <code>TLorentzVector</code> class in the ROOT documentation.     </p>"},{"location":"lecture2/","title":"Lecture 2","text":""},{"location":"lecture2/#plotting-in-root","title":"Plotting in ROOT","text":""},{"location":"lecture3/","title":"Lecture3","text":"<p>to fill</p>"}]}